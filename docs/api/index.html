<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docs - Rynds API</title>
    <link rel="stylesheet" href="/assets/css/style.css?v=20260128">
    <script src="/assets/js/axios.min.js" defer></script>
    <script src="/assets/js/lucide.min.js" defer></script>
    <style>
        .sidebar-scroll::-webkit-scrollbar { width: 4px; }
        .sidebar-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        .glass-panel { background: rgba(20,20,20,0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.08); }
        
        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
            appearance: textfield;
        }
    </style>
</head>
<body class="bg-black text-white flex flex-col md:flex-row h-screen overflow-hidden font-sans antialiased text-sm">

    <!-- Mobile Header -->
    <header class="md:hidden flex items-center justify-between p-4 border-b border-border bg-background z-50">
        <div class="font-bold text-lg tracking-tight">rynds/docs</div>
        <button type="button" onclick="toggleSidebar()" class="p-2 text-secondary hover:text-white" aria-label="Toggle Menu">
            <i data-lucide="menu" class="w-6 h-6" aria-hidden="true"></i>
        </button>
    </header>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-background border-r border-border transform -translate-x-full md:translate-x-0 transition-transform duration-200 z-40 flex flex-col pt-16 md:pt-0">
        <div class="p-5 border-b border-border flex items-center gap-3 md:hidden">
            <span class="font-bold text-lg">Navigation</span>
            <button type="button" onclick="toggleSidebar()" class="ml-auto" aria-label="Close Sidebar"><i data-lucide="x" class="w-5 h-5" aria-hidden="true"></i></button>
        </div>

        <div class="p-5 hidden md:block">
            <div class="font-bold text-lg tracking-tight flex items-center gap-2">
                <div class="w-6 h-6 rounded-full"></div>
                rynds/docs
            </div>
        </div>
        
        <!-- Search -->
        <div class="px-5 mb-4">
            <div class="relative group">
                <label for="search-input" class="sr-only">Search documentation</label>
                <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-gray-500 group-focus-within:text-white transition-colors" aria-hidden="true"></i>
                <input type="text" id="search-input" placeholder="Search documentation..." 
                    class="w-full bg-surface border border-border rounded-md py-2 pl-9 pr-3 text-sm text-gray-300 placeholder-gray-600 focus:outline-none focus:border-gray-500 focus:ring-1 focus:ring-gray-500 transition-all">
            </div>
        </div>

        <nav class="flex-1 overflow-y-auto px-5 pb-8 space-y-8 sidebar-scroll" id="nav-container">
            <!-- Will be populated by JS -->
        </nav>

        <div class="p-4 border-t border-border mt-auto">
            <a href="/" class="flex items-center gap-2 text-xs text-secondary hover:text-white transition-colors justify-center">
                <i data-lucide="arrow-left" class="w-3 h-3" aria-hidden="true"></i> Back to Landing Page
            </a>
        </div>
    </aside>

    <!-- Overlay -->
    <div id="overlay" onclick="toggleSidebar()" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-30 hidden md:hidden transition-opacity opacity-0"></div>

    <!-- Main Content -->
    <main class="flex-1 md:ml-72 h-full overflow-y-auto bg-background scroll-smooth">
        <div class="max-w-4xl mx-auto px-6 py-12 pb-32 md:px-12 md:py-16 md:pb-16 space-y-20">

            <section id="intro" class="max-w-3xl">
                <h1 class="text-4xl md:text-5xl font-bold tracking-tight mb-6">Introduction</h1>
                <p class="text-lg text-secondary leading-relaxed">
                    Access programmatically through our robust REST API. Responses are strictly typed JSON. 
                    Security is enforced via Bearer Tokens.
                </p>
                <div class="mt-8 flex gap-4">
                    <div class="bg-surface border border-border rounded-lg p-4 flex-1">
                        <div class="text-secondary text-xs uppercase font-bold mb-1">Base URL</div>
                        <div class="font-mono text-sm">https://api.rynds.my.id/</div>
                    </div>
                </div>
            </section>

            <!-- Dynamic Sections Container -->
            <div id="endpoints-container">
                <!-- Will be populated by JS -->
            </div>

        </div>
    </main>

    <script>
        let apiData = null;

        // Fetch and render API documentation
        async function loadDocs() {
            try {
                const res = await fetch('/data/docs.json');
                apiData = await res.json();
                renderNavigation();
                renderEndpoints();
                lucide.createIcons();
            } catch (err) {
                console.error('Failed to load docs:', err);
            }
        }

        // Render sidebar navigation
        function renderNavigation() {
            const nav = document.getElementById('nav-container');
            
            // Getting Started
            nav.innerHTML = `
                <div>
                    <h3 class="text-xs font-semibold text-secondary uppercase tracking-wider mb-3">Getting Started</h3>
                    <ul class="space-y-1">
                        <li><a href="#intro" class="block py-1.5 text-gray-400 hover:text-white transition-colors">Introduction</a></li>
                    </ul>
                </div>
            `;

            // Categories
            apiData.categories.forEach(cat => {
                const endpoints = apiData.endpoints.filter(e => e.category === cat.id);
                const catHtml = `
                    <div>
                        <h3 class="text-xs font-semibold text-secondary uppercase tracking-wider mb-3">${cat.name}</h3>
                        <ul class="space-y-1">
                            ${endpoints.map(ep => `
                                <li>
                                    <a href="#${ep.id}" class="block py-1.5 text-gray-400 hover:text-white transition-colors flex items-center gap-2">
                                        <span class="w-1.5 h-1.5 rounded-full ${getMethodColor(ep.method)}" aria-hidden="true"></span>
                                        ${ep.title}
                                    </a>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
                nav.innerHTML += catHtml;
            });
        }

        // Render endpoint sections
        function renderEndpoints() {
            const container = document.getElementById('endpoints-container');
            
            apiData.endpoints.forEach((ep, index) => {
                const section = document.createElement('section');
                section.id = ep.id;
                section.className = 'searchable-section';
                section.innerHTML = `
                    <div class="sticky top-0 bg-background/95 backdrop-blur z-20 py-4 border-b border-background mb-3 ${index > 0 ? 'mt-32' : ''}">
                        <h2 class="text-2xl font-bold">${ep.title}</h2>
                    </div>
                    
                    <p class="text-secondary mb-4">${ep.description}</p>
                    
                    <div class="glass-panel rounded-xl overflow-hidden shadow-2xl shadow-black/50 mb-4">
                        <div class="border-b border-border bg-surface/50 p-4 flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="${getMethodBadgeClass(ep.method)}">${ep.method}</span>
                                <span class="font-mono text-sm text-gray-300">${ep.endpoint}</span>
                            </div>
                            <div class="text-xs text-secondary">${ep.isPublic ? 'Public Endpoint' : 'Protected'}</div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 divide-y lg:divide-y-0 lg:divide-x divide-border">
                            <!-- Request Panel -->
                            <div class="p-6 space-y-4">
                                ${renderInputs(ep)}
                                <button type="button" onclick="executeRequest('${ep.id}')" 
                                    class="w-full bg-white text-black font-semibold h-9 rounded text-sm hover:bg-gray-200 transition-colors flex items-center justify-center gap-2">
                                    <i data-lucide="play" class="w-3.5 h-3.5 fill-current" aria-hidden="true"></i> Send Request
                                </button>
                            </div>

                            <!-- Response Panel -->
                            <div class="p-6 bg-[#080808] relative group">
                                <div class="absolute top-4 right-4 text-xs font-mono text-secondary group-hover:opacity-100 opacity-50 transition-opacity" id="status-${ep.id}">
                                    Ready
                                </div>
                                <pre id="res-${ep.id}" class="font-mono text-xs text-green-400 overflow-x-auto min-h-32 scrollbar-hide">${JSON.stringify(ep.responseExample, null, 2)}</pre>
                            </div>
                        </div>
                        
                        ${renderRateLimit(ep)}
                    </div>
                `;
                container.appendChild(section);
            });
        }

        // Render input fields
        function renderInputs(endpoint) {
            if (!endpoint.inputs || endpoint.inputs.length === 0) {
                return '<p class="text-sm text-secondary">No parameters required.</p>';
            }

            return `
                <div class="space-y-3">
                    ${endpoint.inputs.map(input => {
                        if (input.type === 'select') {
                            return `
                                <div>
                                    <label for="input-${endpoint.id}-${input.name}" class="block text-xs font-medium text-secondary mb-1.5">${input.label}${input.required ? ' *' : ''}</label>
                                    <select id="input-${endpoint.id}-${input.name}" class="w-full bg-[#1a1a1a] border border-border rounded px-3 py-2 text-sm text-white focus:ring-1 focus:ring-white focus:border-white transition-all outline-none">
                                        ${input.options.map(opt => `<option value="${opt.value}" ${opt.value === input.default ? 'selected' : ''}>${opt.label}</option>`).join('')}
                                    </select>
                                </div>
                            `;
                        } else {
                            return `
                                <div>
                                    <label for="input-${endpoint.id}-${input.name}" class="block text-xs font-medium text-secondary mb-1.5">${input.label}${input.required ? ' *' : ''}</label>
                                    <input type="${input.type}" 
                                        id="input-${endpoint.id}-${input.name}" 
                                        placeholder="${input.placeholder || ''}"
                                        ${input.default ? `value="${input.default}"` : ''}
                                        class="w-full bg-[#1a1a1a] border border-border rounded px-3 py-2 text-sm text-white focus:ring-1 focus:ring-white focus:border-white transition-all outline-none">
                                </div>
                            `;
                        }
                    }).join('')}
                </div>
            `;
        }

        // Render rate limit info
        function renderRateLimit(endpoint) {
            if (!endpoint.rateLimit) return '';
            return `
                <div class="border-t border-border p-4 bg-surface/30">
                    <div class="text-xs text-secondary flex items-center gap-2">
                        <i data-lucide="zap" class="w-3 h-3" aria-hidden="true"></i>
                        Rate Limit: ${endpoint.rateLimit.requests} requests per ${endpoint.rateLimit.window}
                    </div>
                </div>
            `;
        }

        // Execute API request
        async function executeRequest(endpointId) {
            const endpoint = apiData.endpoints.find(e => e.id === endpointId);
            const resBox = document.getElementById(`res-${endpointId}`);
            const statusBox = document.getElementById(`status-${endpointId}`);
            
            statusBox.innerText = 'Requesting...';
            statusBox.className = 'absolute top-4 right-4 text-xs font-mono text-yellow-500 animate-pulse';

            // Collect input values
            const data = {};
            let url = endpoint.endpoint;
            
            endpoint.inputs.forEach(input => {
                const value = document.getElementById(`input-${endpointId}-${input.name}`)?.value;
                if (value) {
                    if (input.location === 'path') {
                        url = url.replace(`:${input.name}`, value);
                    } else {
                        data[input.name] = input.type === 'number' ? Number(value) : value;
                    }
                }
            });

            try {
                const start = Date.now();
                const config = { 
                    method: endpoint.method, 
                    url, 
                    validateStatus: () => true 
                };
                
                if (endpoint.method !== 'GET' && Object.keys(data).length > 0) {
                    config.data = data;
                } else if (endpoint.method === 'GET' && Object.keys(data).length > 0) {
                    config.params = data;
                }

                const res = await axios(config);
                const ms = Date.now() - start;

                const isError = res.status >= 400;
                statusBox.innerText = `${res.status} â€¢ ${ms}ms`;
                statusBox.className = `absolute top-4 right-4 text-xs font-mono font-bold ${isError ? 'text-red-500' : 'text-green-500'}`;

                // Check if response is binary (audio file)
                if (res.headers['content-type']?.includes('audio') || res.headers['content-type']?.includes('octet-stream')) {
                    resBox.innerHTML = `<div class="text-green-400">File ready to play<br><br><a href="${url}" target="_blank" class="text-blue-400 underline hover:text-blue-300">Click here to download/play: ${url}</a></div>`;
                } else {
                    resBox.innerText = JSON.stringify(res.data, null, 2);
                }
                resBox.className = `font-mono text-xs overflow-x-auto min-h-32 scrollbar-hide ${isError ? 'text-red-400' : 'text-green-400'}`;
            } catch (err) {
                statusBox.innerText = 'NET_ERR';
                statusBox.className = 'absolute top-4 right-4 text-xs font-mono font-bold text-red-600';
                resBox.innerText = err.message;
                resBox.className = 'font-mono text-xs text-red-600 overflow-x-auto min-h-32 scrollbar-hide';
            }
        }

        // Helper: Get method color
        function getMethodColor(method) {
            const colors = {
                'GET': 'bg-emerald-500',
                'POST': 'bg-indigo-500',
                'PUT': 'bg-yellow-500',
                'DELETE': 'bg-red-500',
                'PATCH': 'bg-orange-500'
            };
            return colors[method] || 'bg-gray-500';
        }

        // Helper: Get method badge class
        function getMethodBadgeClass(method) {
            const classes = {
                'GET': 'bg-emerald-500/20 text-emerald-300 border-emerald-500/30',
                'POST': 'bg-indigo-500/20 text-indigo-300 border-indigo-500/30',
                'PUT': 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30',
                'DELETE': 'bg-red-500/20 text-red-300 border-red-500/30',
                'PATCH': 'bg-orange-500/20 text-orange-300 border-orange-500/30'
            };
            return `${classes[method] || 'bg-gray-500/20 text-gray-300 border-gray-500/30'} px-2 py-0.5 rounded text-xs font-mono font-bold border`;
        }

        // Sidebar toggle
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        function toggleSidebar() {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
            setTimeout(() => overlay.classList.toggle('opacity-0'), 10);
        }

        // Search functionality
        const searchInput = document.getElementById('search-input');
        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const sections = document.querySelectorAll('.searchable-section');
            sections.forEach(sec => {
                const text = sec.innerText.toLowerCase();
                sec.style.display = text.includes(term) ? 'block' : 'none';
            });
        });

        // Auto-check endpoints on load
        function autoCheckEndpoints() {
            if (!apiData) return;
            
            apiData.endpoints.forEach(ep => {
                if (ep.autoCheck) {
                    // Wait a bit for DOM to be ready
                    setTimeout(() => executeRequest(ep.id), 500);
                }
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await loadDocs();
            autoCheckEndpoints();
        });
    </script>
</body>
</html>
